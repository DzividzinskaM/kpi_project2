{% extends 'base.html' %}
{% load static %}
{% block cssload %}{% static 'css/index.css' %}{% endblock %}
{% block head %}
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script>
    <script src="http://malsup.github.com/jquery.form.js"></script>

    <script>
        function f(name) {
            alert(name)
        }
    </script>
{% endblock %}
{% block body %}
    <div id="mini-cart"></div>
    <div id="goods"></div>
    {% if success %}
        <div class="alert alert-success" role="alert">
            Реєстрація пройшла успішно!
        </div>
    {% elif login_success %}
        <div class="alert alert-success" role="alert">
            Ви успішно ввійшли!
        </div>
    {% endif %}
    <div class="order">

    </div>
    {% for i in costumes %}
        <form class="single-goods" method="post">{% csrf_token %}
            <h3 id="name">{{ i.costume_name }}</h3>
            <p>Ціна: {{ i.costume_price }}</p>
            <img src={{ i.costume_image }}>
            <button class="add" type="submit" onclick="func(event, '{{ i.costume_name }}')">Oodo</button>
        </form>
    {% endfor %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>


        function func(event, i) {
            event.preventDefault();
            $('.order').html(`<div class=\"alert alert-success\" role=\"alert\" id=\"orderbox\">${i}</div>`)
        }

        let cart = {}; //my cart
        $('document').ready(function () {
            loadGoods();
            checkCart();
            showMiniCart();
        });

        function loadGoods() {
            let data;
            //download products to page
            $.getJSON('http://localhost:3000/goods.json', function (data) {
                //console.log(data);
                let out = '';
                for (let key in data) {
                    out += '<div class="single-goods">';
                    out += '<h3>' + data[key]['name'] + '</h3>';
                    out += '<p>Price: ' + data[key]['cost'] + '</p>';
                    out += '<img src="' + data[key]['image'] + '">';
                    out += '<button class="add-to-cart" data-art="' + key + '">Орендувати</button>';
                    out += '</div>';
                }
                $('#goods').html(out);
                $('button.add-to-cart').on('click', addToCart);
            });
        }

        function addToCart() {
            //add products to cart
            let articul = $(this).attr('data-art');
            if (cart[articul] != undefined) {
                cart[articul]++;
            } else {
                cart[articul] = 1;
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            //console.log(cart);
            showMiniCart();
        }

        function checkCart() {
            //check cart in localStorage
            if (localStorage.getItem('cart') != null) {
                cart = JSON.parse(localStorage.getItem('cart'));
            }
        }

        function showMiniCart() {
            //show products in mini cart
            let out = '';
            for (let i in cart) {
                out += i + ' --- ' + cart[i] + '<br>';
            }
            //$('#mini-cart').html(out);
        }

    </script>
{% endblock %}