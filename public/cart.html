<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Cart</title>
</head>
<body>
    <div id="my-cart"></div>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
        let cart = {}; 

        $.getJSON('goods.json', function(data){
            let goods = data;   //all products in arr
            //console.log(data);
            checkCart();
            //console.log(cart);
            showCart();  //show products at page
            
            function showCart(){
                if($.isEmptyObject(cart)) {
                    let out='Корзина порожня. Додайте товар в корзину <a href="/..">Головна сторінка</a>' ;
                    $('#my-cart').html(out);
                }
                else {
                    let out = '';
                    for(let key in cart){
                        out += '<button class="delete" data-art="'+key+'">x</button>';
                        out += '<img src="'+goods[key].image +'" width="48">';
                        out += goods[key].name;
                        out += '<button class="minus" data-art="'+key+'">-</button>';
                        out += cart[key];
                        out += '<button class="plus" data-art="'+key+'">+</button>';
                        out += cart[key]*goods[key].cost;
                        out += '<br>';
                    }

                    $('#my-cart').html(out);
                    $('.plus').on('click', plusGoods);
                    $('.minus').on('click', minusGoods);
                    $('.delete').on('click', deleteGoods);
                } 
            }

            function plusGoods(){
                let articul = $(this).attr('data-art');
                cart[articul]++;
                saveCartToLS();
                showCart();
            }

            function minusGoods(){
                let articul = $(this).attr('data-art');
                if(cart[articul]>1){
                    cart[articul]--;
                }
                else {
                    delete cart[articul];
                }
                saveCartToLS();
                showCart();
            }

            function deleteGoods(){
                let articul = $(this).attr('data-art');
                delete cart[articul];
                saveCartToLS();
                showCart();
            }

        });

        function checkCart(){
			if (localStorage.getItem('cart') != null){
				cart = JSON.parse (localStorage.getItem('cart'));
			}
        }
        

        function saveCartToLS(){
            //save cart in locale storage
            localStorage.setItem('cart', JSON.stringify(cart));
        }


</script>
</body>
</html>